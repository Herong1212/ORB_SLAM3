cmake_minimum_required(VERSION 3.20)
project(orb_slam3_ros)

# ç”¨äº åœ¨ ROS é¡¹ç›®ä¸­å¼•å…¥ rosbuild ç¼–è¯‘ç³»ç»Ÿï¼Œrosbuild æ˜¯ ROS ä¸­çš„ä¸€ä¸ªè¾ƒæ—§çš„æ„å»ºå·¥å…·ï¼Œé€šå¸¸ç”¨äº ROS æ—©æœŸç‰ˆæœ¬ï¼ˆå¦‚ ROS 1 çš„æ—§å‘è¡Œç‰ˆï¼‰ã€‚
# rosbuild å·²è¢«åºŸå¼ƒï¼šåœ¨æ–°ç‰ˆæœ¬çš„ ROSï¼ˆå¦‚ ROS Noeticã€ROS 2ï¼‰ä¸­ï¼Œæ¨èä½¿ç”¨ catkin æˆ– ament è€Œé rosbuildã€‚ä¹Ÿå°±æ˜¯åœ¨æœ¬æœºä¸Šä¸éœ€è¦è¯¥è¡Œä»£ç ï¼
# include($ENV{ROS_ROOT}/core/rosbuild/rosbuild.cmake)

# $ENV{ROS_ROOT} è¡¨ç¤ºè®¿é—®ç¯å¢ƒå˜é‡ ROS_ROOTï¼Œè¯¥å˜é‡é€šå¸¸æŒ‡å‘ ROS çš„å®‰è£…ç›®å½•ï¼Œæ¯”å¦‚ /opt/ros/<distro>ã€‚
# message("ROS_ROOT: " ${ROS_ROOT})

# rosbuild_init() ä¼šåˆå§‹åŒ– rosbuild çš„ä¸€äº›é»˜è®¤è®¾ç½®ï¼ŒåŠ è½½ä¸æ„å»ºã€ä¾èµ–å…³ç³»å’Œæ–‡ä»¶è·¯å¾„ç›¸å…³çš„é…ç½®ã€‚
# å®ƒä¼šåœ¨ CMakeLists.txt æ–‡ä»¶ä¸­è®¾ç½®ç¼–è¯‘é€‰é¡¹ã€åŒ…å«è·¯å¾„å’Œé“¾æ¥åº“ç­‰ï¼Œä»¥ä¾¿åç»­å¯ä»¥ä½¿ç”¨ rosbuild æä¾›çš„æ„å»ºåŠŸèƒ½ã€‚
# åœ¨ ROS Noetic ä¸­ï¼Œå› ä¸º rosbuild å·²ä¸å†æ¨èä½¿ç”¨ï¼Œå»ºè®®ç”¨ catkin æ¥ä»£æ›¿ rosbuild_init() çš„åŠŸèƒ½ã€‚
# rosbuild_init()

message("")
message("----------------------åˆå§‹åŒ–å®Œæˆï¼-----------------------------------" \n)

set(ROS_BUILD_TYPE Release)
# set(ROS_BUILD_TYPE Debug)

message("ROS_BUILD_TYPE: " ${ROS_BUILD_TYPE})
message("")

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -O3 -march=native")

message("CMAKE_CXX_FLAGS: " ${CMAKE_CXX_FLAGS})
message("")

# Check C++11 or C++0x support
include(CheckCXXCompilerFlag)
CHECK_CXX_COMPILER_FLAG("-std=c++11" COMPILER_SUPPORTS_CXX11)
CHECK_CXX_COMPILER_FLAG("-std=c++0x" COMPILER_SUPPORTS_CXX0X)

if(COMPILER_SUPPORTS_CXX11)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")
    add_definitions(-DCOMPILEDWITHC11)
    message(STATUS "Using flag -std=c++11.")
elseif(COMPILER_SUPPORTS_CXX0X)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++0x")
    add_definitions(-DCOMPILEDWITHC0X)
    message(STATUS "Using flag -std=c++0x.")
else()
    message(FATAL_ERROR "The compiler ${CMAKE_CXX_COMPILER} has no C++11 support. Please use a different C++ compiler.")
endif()
message("")

list(APPEND CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/../../../cmake_modules)

# æŸ¥æ‰¾ catkinï¼Œå¹¶å¼•å…¥æ‰€éœ€çš„ç»„ä»¶ï¼ˆä¾‹å¦‚ roscpp å’Œ std_msgsï¼‰
find_package(catkin REQUIRED COMPONENTS
    roscpp
    std_msgs
    sensor_msgs
    image_transport
    cv_bridge
    tf
    geometry_msgs
    # å…¶ä»–ä¾èµ–é¡¹
)

# è¦ä¿è¯æ•´ä¸ªå·¥ç¨‹çš„ opencv ç‰ˆæœ¬ä¸€è‡´ï¼ŒåŒ…æ‹¬ dbowï¼Œæºç ä»¥åŠ ros ç›¸å…³çš„
# 3 4 éƒ½å¯ä»¥æ­£å¸¸è¿è¡Œ
find_package(OpenCV REQUIRED)
message("OpenCV Version: " ${OpenCV_VERSION})
message("OpenCV_INCLUDE_DIRS: " ${OpenCV_INCLUDE_DIRS})
message("OpenCV_LIBRARIES: " ${OpenCV_LIBRARIES})
message("")

find_package(Eigen3 REQUIRED)
message("Eigen3 version: ${Eigen3_VERSION}")
message("")
find_package(Pangolin REQUIRED)
message("Pangolin version: ${Pangolin_VERSION}")
message("")

message("PROJECT_SOURCE_DIR: " ${PROJECT_SOURCE_DIR}) # /home/dsg/orbslam3_ghr/src/ORB_SLAM3/Examples/ROS/ORB_SLAM3
include_directories(
    ${PROJECT_SOURCE_DIR}
    ${PROJECT_SOURCE_DIR}/../../../
    ${PROJECT_SOURCE_DIR}/../../../include
    ${PROJECT_SOURCE_DIR}/../../../include/CameraModels
    ${PROJECT_SOURCE_DIR}/../../../Thirdparty/Sophus
    ${Pangolin_INCLUDE_DIRS}
    ${catkin_INCLUDE_DIRS}
)
message("æ ‡è®°ç¬¬ä¸€å¤„åœ°ç‚¹ï¼")
message("")

set(LIBS
    ${OpenCV_LIBS}
    ${Pangolin_LIBRARIES}
    ${EIGEN3_LIBRARIES}
    ${PROJECT_SOURCE_DIR}/../../../Thirdparty/DBoW2/lib/libDBoW2.so
    ${PROJECT_SOURCE_DIR}/../../../Thirdparty/g2o/lib/libg2o.so
    ${PROJECT_SOURCE_DIR}/../../../lib/libORB_SLAM3.so
    -lboost_system
    ${catkin_LIBRARIES}
)
message("æ ‡è®°ç¬¬äºŒå¤„åœ°ç‚¹ï¼")
message("")

# å£°æ˜catkinçš„åŒ…
catkin_package(
    # å¦‚æœæœ‰åº“æˆ–å…¶ä»–éœ€è¦å¯¼å‡ºçš„å†…å®¹å¯ä»¥åœ¨è¿™é‡Œå¡«å†™
    CATKIN_DEPENDS roscpp sensor_msgs cv_bridge image_transport
)

# ------------------------------------------- ğŸ‘‡ç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶ğŸ‘‡ ----------------------------------------------------
# å¦‚æœé‡‡ç”¨ rosbuild æ–¹æ³•ï¼Œé‚£å°±ç”¨è¿™ä¸ªã€‚å¦‚æœä½¿ç”¨ catkin æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨æ ‡å‡†çš„ CMake  ç¼–è¯‘å‘½ä»¤å³å¯ã€‚
# rosbuild_add_executable(Mono src/ros_mono.cc)     # å•ç›®
# target_link_libraries(Mono ${LIBS})

# æ›´æ”¹å¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å‡ºè·¯å¾„
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/src)

# Node for monocular camera
add_executable(Mono src/ros_mono.cc) # å•ç›®
target_link_libraries(Mono ${LIBS})

# set_target_properties(Mono PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/bin333)

# Node for stereo camera
add_executable(Stereo src/ros_stereo.cc) # åŒç›®
target_link_libraries(Stereo ${LIBS})

# Node for RGB-D camera
add_executable(RGBD src/ros_rgbd.cc) # RGB-D
target_link_libraries(RGBD ${LIBS})

# Node for monocular-inertial camera
add_executable(Mono_Inertial src/ros_mono_inertial.cc) # å•ç›® + IMU
target_link_libraries(Mono_Inertial ${LIBS})

# Node for stereo-inertial camera
add_executable(Stereo_Inertial src/ros_stereo_inertial.cc) # åŒç›® + IMU
target_link_libraries(Stereo_Inertial ${LIBS})

# Node for rgbd-inertial camera
add_executable(RGBD_Inertial src/ros_rgbd_inertial.cc) # RGB-D + IMU
target_link_libraries(RGBD_Inertial ${LIBS})


